# Dashboard Generator - 功能增强需求文档 (V2)

## 1. 概述

本文档基于对现有 Dashboard Generator V1 功能的审查，提出一系列高价值的功能增强需求。核心目标是将产品从一个一次性的代码生成器，升级为一个智能、可交互、高度实用的开发者助手，从而最大化AI的核心价值。

所有功能设计遵循 **KISS (Keep It Simple, Stupid)** 和 **YAGNI (You Aren't Gonna Need It)** 原则，优先实现核心价值。

---

## 2. 核心功能增强

### 2.1. 功能一：对话式迭代优化 (Conversational Iterative Refinement)

- **优先级:** **最高**
- **核心价值:** 将产品从“代码生成器”升级为“智能代码助手”，提供颠覆性的交互体验。

#### 2.1.1. 用户故事

- **As a** 用户,
- **I want to** 在仪表板生成后，通过自然语言对话的方式对代码进行修改和优化,
- **So that** 我可以快速、直观地将生成的代码调整为我最终想要的样子，而无需手动修改或重新生成。

#### 2.1.2. 功能描述

1.  在仪表板代码生成结果页面，提供一个聊天/对话界面。
2.  用户可以在聊天框中输入具体的修改指令。
    - **示例指令 1 (样式修改):** “把所有卡片的圆角从8px改为16px。”
    - **示例指令 2 (结构修改):** “在数据表格的‘销售额’列后面增加一列‘同比增长率’。”
    - **示例指令 3 (内容修改):** “将页面主标题改为‘2025年第一季度销售报告’。”
3.  系统接收指令后，AI会智能分析并修改现有代码（HTML/CSS/JS），然后实时更新预览。
4.  用户可以进行多轮对话，直到对结果满意为止。

#### 2.1.3. 技术实现要点

- **后端:**
    - 新增 API 接口: `POST /api/dashboard/refine`。
    - 接口接收参数:
        - `originalCode`: 包含 `html`, `css`, `javascript` 的对象。
        - `instruction`: 用户的自然语言修改指令（字符串）。
    - 在 `DashboardAiAssistant` 接口中增加 `refineDashboard` 方法，其提示词需要包含原始代码和用户指令，并要求AI返回修改后的完整代码。
- **前端:**
    - 实现一个聊天组件用于用户输入。
    - 实现一个代码预览区域，可以接收新的代码并动态刷新。

### 2.2. 功能二：引入真实数据生成 (Bring Your Own Data - BYOD)

- **优先级:** **高**
- **核心价值:** 使生成的仪表板从“静态模板”变为“开箱即用的数据应用”，极大提升实用性。

#### 2.2.1. 用户故事

- **As a** 用户,
- **I want to** 在生成仪表板时，直接粘贴我自己的JSON格式数据,
- **So that** AI可以围绕我的真实数据生成图表和组件，让我立即看到有意义的可视化结果。

#### 2.2.2. 功能描述

1.  在仪表板配置流程中，增加一个“提供数据”的步骤（可选）。
2.  提供一个文本输入框，用户可以将 **JSON 格式** 的数据粘贴进去。
3.  AI将自动分析JSON的数据结构（键名、数据类型等）。
4.  最终生成的仪表板，其图表和表格将直接使用用户提供的数据进行渲染。
    - **示例:** 用户粘贴 `[{"date": "2025-01-01", "users": 150}, {"date": "2025-01-02", "users": 180}]`，AI能自动生成一个以`date`为X轴，`users`为Y轴的折线图。

#### 2.2.3. 技术实现要点

- **后端:**
    - 在 `DashboardRequest` DTO 中增加一个可选字段 `String jsonData`。
    - 在提示词构建逻辑中，如果 `jsonData` 存在，将其内容和结构描述注入到提示词中，并明确指示AI使用此数据。
- **前端:**
    - 在配置向导中增加一个步骤，包含一个用于粘贴JSON数据的文本域。

### 2.3. 功能三：支持 Vue.js 框架生成

- **优先级:** **中**
- **核心价值:** 拓宽产品用户群，服务于广大的 Vue.js 开发者。

#### 2.3.1. 用户故事

- **As a** Vue.js 开发者,
- **I want to** 选择将仪表板生成为 Vue 3 的单文件组件 (SFC - Single-File Component),
- **So that** 我可以无缝地将生成的代码集成到我现有的 Vue 项目中。

#### 2.3.2. 功能描述

1.  在“生成选项” (`GenerationOptions`) 中，增加一个“目标框架”的选项。
2.  目前该选项只支持“原生JS/HTML”和“Vue 3”。
3.  当用户选择“Vue 3”时，AI将生成一个完整的 `.vue` 文件格式的代码，包含 `<template>`, `<script setup>`, 和 `<style scoped>` 部分。

#### 2.3.3. 技术实现要点

- **后端:**
    - 在 `GenerationOptions` DTO 中增加 `String framework` 字段 (`"native"` 或 `"vue3"`)。
    - 在 `GenerationResult` DTO 中，当生成Vue代码时，可以将三部分代码合并为一个 `vueComponentCode` 字段，或保持分离由前端合并。
    - 在提示词构建逻辑中，根据 `framework` 字段的值，向AI提出明确的技术要求，例如：“请生成一个符合Vue 3 Composition API (`<script setup>`)规范的单文件组件。”

### 2.4. 功能四：一键导出功能

- **优先级:** **中**
- **核心价值:** 优化开发者工作流，提供超出预期的便利性。

#### 2.4.1. 用户故事

- **As a** 用户,
- **I want to** 通过点击一个按钮，将生成的代码打包为 .zip 文件下载，或者直接在 CodePen 中打开,
- **So that** 我可以方便地保存、分享或调试生成的代码。

#### 2.4.2. 功能描述

1.  在生成结果页面，提供一个“导出”按钮，包含下拉选项：
    - **导出为 .zip:** 将代码（`index.html`, `style.css`, `script.js` 或 `Dashboard.vue`）打包成一个zip文件。
    - **在 CodePen 中打开:** 将代码发送到 CodePen.io 进行在线预览和编辑。

#### 2.4.3. 技术实现要点

- **后端 (ZIP导出):**
    - 新增 API 接口: `POST /api/dashboard/export/zip`。
    - 接口接收 `html`, `css`, `javascript` 代码。
    - 使用 `java.util.zip.ZipOutputStream` 在内存中创建zip文件流并返回给前端下载。
- **前端 (CodePen集成):**
    - 此功能可纯前端实现。通过创建一个包含特定 `data` 属性的隐藏 `form`，然后用JavaScript触发表单提交，即可将代码发送到CodePen。

---

## 3. 建议实施顺序

为了以最小成本实现最大价值，建议按以下顺序进行开发：

1.  **功能一：对话式迭代优化** (核心体验升级)
2.  **功能二：引入真实数据生成** (核心实用性升级)
3.  **功能三 & 四：Vue支持与导出功能** (拓宽用户群与优化工作流)
